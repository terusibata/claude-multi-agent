# AIエージェントバックエンド 環境変数設定例
# 本番環境ではすべての REQUIRED 項目を設定してください

# ============================================
# データベース設定
# ============================================
DB_USER=aiagent
# REQUIRED: 本番環境では安全なパスワードを設定
DB_PASSWORD=
DB_NAME=aiagent
DB_PORT=5432
# REQUIRED: 本番環境では安全な認証情報を使用
DATABASE_URL=

# コネクションプール設定
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=40
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600
DB_CONNECT_TIMEOUT=10
DB_COMMAND_TIMEOUT=60

# ============================================
# Redis設定
# ============================================
REDIS_URL=redis://localhost:6379/0
REDIS_MAX_CONNECTIONS=20
REDIS_SOCKET_TIMEOUT=5.0
REDIS_SOCKET_CONNECT_TIMEOUT=5.0
# REQUIRED: 本番環境ではRedis認証を設定
REDIS_PASSWORD=

# ============================================
# AWS Bedrock設定
# ============================================
CLAUDE_CODE_USE_BEDROCK=1
AWS_REGION=us-west-2

# 開発環境: AWS認証情報（本番環境ではIAMロールを使用）
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
# AWS_SESSION_TOKEN=

# Bedrockリトライ設定
BEDROCK_MAX_RETRIES=3
BEDROCK_RETRY_BASE_DELAY=1.0
BEDROCK_RETRY_MAX_DELAY=10.0

# モデル設定
ANTHROPIC_SONNET_MODEL=global.anthropic.claude-sonnet-4-5-20250929-v1:0
ANTHROPIC_HAIKU_MODEL=global.anthropic.claude-haiku-4-5-20251001-v1:0
CLAUDE_CODE_SUBAGENT_MODEL=haiku

# ============================================
# アプリケーション設定
# ============================================
# development / production
APP_ENV=development
APP_PORT=8000
# DEBUG / INFO / WARNING / ERROR
LOG_LEVEL=INFO
# グレースフルシャットダウンのタイムアウト（秒）
SHUTDOWN_TIMEOUT=30.0

# Skills保存ベースパス
SKILLS_BASE_PATH=/skills

# ============================================
# S3ワークスペース設定
# ============================================
S3_BUCKET_NAME=
S3_WORKSPACE_PREFIX=workspaces/
WORKSPACE_TEMP_DIR=/var/lib/aiagent/workspaces
# S3チャンクサイズ（バイト）
S3_CHUNK_SIZE=8388608

# ファイルアップロード制限（バイト）
MAX_UPLOAD_FILE_SIZE=104857600
MAX_IMAGE_FILE_SIZE=5242880
MAX_PDF_FILE_SIZE=20971520
MAX_OFFICE_FILE_SIZE=31457280
MAX_TEXT_FILE_SIZE=5242880

# ============================================
# セキュリティ設定
# ============================================
# CORS設定
CORS_ORIGINS=http://localhost:3000,http://localhost:3001
CORS_METHODS=GET,POST,PUT,DELETE,OPTIONS
CORS_HEADERS=Content-Type,Authorization,X-API-Key,X-Request-ID,X-Tenant-ID,X-User-ID,X-Admin-ID

# REQUIRED: 本番環境ではAPIキーを設定（16文字以上、カンマ区切りで複数指定可能）
API_KEYS=

# レート制限
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_PERIOD=60

# HSTS（HTTP Strict Transport Security）
HSTS_ENABLED=true
HSTS_MAX_AGE=31536000

# ============================================
# コンテナ隔離設定
# ============================================
CONTAINER_IMAGE=workspace-base:latest
CONTAINER_CPU_QUOTA=200000
CONTAINER_MEMORY_LIMIT=2147483648
CONTAINER_PIDS_LIMIT=256
# CONTAINER_DISK_LIMIT=5G  # 本番のみ（xfs+pquota必須、開発環境では未設定のまま）
CONTAINER_INACTIVE_TTL=3600
CONTAINER_ABSOLUTE_TTL=28800
CONTAINER_EXECUTION_TIMEOUT=600
CONTAINER_GRACE_PERIOD=30
CONTAINER_HEALTHCHECK_INTERVAL=30
CONTAINER_GC_INTERVAL=60

# WarmPool設定
WARM_POOL_MIN_SIZE=2
WARM_POOL_MAX_SIZE=10
WARM_POOL_TTL=1800

# Proxy設定
PROXY_DOMAIN_WHITELIST=pypi.org,files.pythonhosted.org,registry.npmjs.org,api.anthropic.com,bedrock-runtime.us-east-1.amazonaws.com,bedrock-runtime.us-west-2.amazonaws.com,bedrock-runtime.ap-northeast-1.amazonaws.com
PROXY_LOG_ALL_REQUESTS=true

# セキュリティ強化設定
SECCOMP_PROFILE_PATH=deployment/seccomp/workspace-seccomp.json
USERNS_REMAP_ENABLED=false
# AppArmorプロファイル名（本番: workspace-container、ホストで apparmor_parser -r でロード済みであること）
APPARMOR_PROFILE_NAME=

# Docker設定
DOCKER_SOCKET_PATH=unix:///var/run/docker.sock
WORKSPACE_SOCKET_BASE_PATH=/var/run/workspace-sockets
# Docker-in-Docker環境用（ホスト側パス）
WORKSPACE_SOCKET_HOST_PATH=

# ============================================
# メトリクス設定
# ============================================
METRICS_ENABLED=true

# ============================================
# Uvicorn設定
# ============================================
UVICORN_WORKERS=1
UVICORN_TIMEOUT_KEEP_ALIVE=65
UVICORN_TIMEOUT_NOTIFY=30
